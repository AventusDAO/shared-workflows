name: reusable - Terraform Docs

on:
  workflow_call:
    inputs:
      agent:
        required: false
        type: string
        description: "Agent where the workflow will be run"
        default: ubuntu-latest
      checkout_repository:
        required: false
        type: string
        description: "Repository to checkout (owner/repo format). If empty, uses the current repository"
        default: ""
      checkout_ref:
        required: false
        type: string
        description: "Git ref to checkout (branch, tag, or commit SHA). If empty, uses the default branch"
        default: ""
      checkout_depth:
        required: false
        type: number
        description: "Depth of checkout. If empty, uses the default depth"
        default: 0

jobs:
  precommit-check:
    runs-on: ${{inputs.agent}}
    steps:
      - name: Check out code
        uses: actions/checkout@v6
        with:
          fetch-depth: ${{ inputs.checkout_depth }}
          ref: ${{ inputs.checkout_ref || github.head_ref || github.ref_name }}
          repository: ${{ inputs.checkout_repository }}

      - name: Render terraform docs and push changes back to PR
        uses: terraform-docs/gh-actions@v1
        with:
          working-dir: .
          output-file: README.md
          output-method: replace
          git-push: true
          git-commit-message: "create terraform-docs"
          template: "<!-- BEGIN_TF_DOCS -->\n{{ .Content }}\n<!-- END_TF_DOCS -->\n"
