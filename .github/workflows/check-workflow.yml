name: Reusable - Terraform Check

on:
  workflow_call:
    inputs:
      agent:
        required: false
        type: string
        description: "Agent where the workflow will be run"
        default: ubuntu-latest
      checkout_repository:
        required: false
        type: string
        description: "Repository to checkout (owner/repo format). If empty, uses the current repository"
        default: ""
    checkout_ref:
      required: false
      type: string
      description: "Git ref to checkout (branch, tag, or commit SHA). If empty, uses the default branch"
      default: ""

jobs:
  precommit-check:
    runs-on: ${{inputs.agent}}
    steps:
      - name: Check out code
        uses: actions/checkout@v6
        with:
          fetch-depth: 0
          ref: ${{ inputs.checkout_ref }}
          repository: ${{ inputs.checkout_repository }}

      - uses: hashicorp/setup-terraform@v3

      - name: Install `pre-commit`
        run: pip install pre-commit

      - name: Install TFLint
        run: curl -s https://raw.githubusercontent.com/terraform-linters/tflint/master/install_linux.sh | bash

      - name: Install `pre-commit` hooks
        run: pre-commit install

      - name: Run `pre-commit`` checks
        run: pre-commit run --all-files
